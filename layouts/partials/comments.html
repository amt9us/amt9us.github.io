<script>
    function getGiscusTheme() {
        const theme = localStorage.getItem("pref-theme");
        const darkTheme = "dark_protanopia";
        const lightTheme = "light_protanopia";

        if (theme === "dark") return darkTheme;
        if (theme === "light") return lightTheme;
        
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? darkTheme : lightTheme;
    }

    function setGiscusTheme() {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;

        setTimeout(() => {
            iframe.contentWindow.postMessage({
                giscus: { setConfig: { theme: getGiscusTheme() } }
            }, 'https://giscus.app');
        }, 150);
    }

    const giscusScript = document.createElement("script");
    giscusScript.src = "https://giscus.app/client.js";
    giscusScript.setAttribute("data-repo", "amt9us/amt9us.github.io");
    giscusScript.setAttribute("data-repo-id", "R_kgDORAu4zQ");
    giscusScript.setAttribute("data-category", "Announcements");
    giscusScript.setAttribute("data-category-id", "DIC_kwDORAu4zc4C1ZMq");
    giscusScript.setAttribute("data-mapping", "pathname");
    giscusScript.setAttribute("data-strict", "0");
    giscusScript.setAttribute("data-reactions-enabled", "1");
    giscusScript.setAttribute("data-emit-metadata", "0");
    giscusScript.setAttribute("data-input-position", "top");
    giscusScript.setAttribute("data-lang", "ko");
    giscusScript.setAttribute("data-theme", getGiscusTheme());
    giscusScript.setAttribute("data-loading", "lazy");
    giscusScript.setAttribute("crossorigin", "anonymous");
    giscusScript.async = true;

    document.currentScript.parentNode.appendChild(giscusScript);

    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.querySelector('#theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', setGiscusTheme);
        }
    });

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setGiscusTheme);
</script>
